webpackJsonp([26],{tYG9:function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=t("P9l9"),n={name:"channelDetail",data:function(){return{activeName:"first",baseData:{channelName:"",channelLevel:"",channelLevels:[{label:"一级",value:"1"},{label:"二级",value:"2"}],address:"",contacter:"",phone:"",email:"",inviteCode:"",status:"0",introduce:"",note:"",ownContact:"",contractAnnex:[],annexId:[],endTime:"",startTime:""},couponTable:[],relation:[],channelRelationList:[],couponData:{limit:"",rule:""},couponRules:{moneyLimit:[{type:"number",required:!0,message:"请输入总金额上限",trigger:"change"}]},rules:{channelName:[{min:3,max:25,message:"3个汉字≤名称≤25个汉字",trigger:"blur"},{required:!0,message:"请输入卡券名称",trigger:"blur"}],channelLevel:[{required:!0,message:"请选择渠道级别",trigger:"change"}],address:[{required:!0,message:"请输入渠道地址",trigger:"blur"}],contacter:[{required:!0,message:"请输入联系人",trigger:"blur"}],phone:[{required:!0,message:"请输入绑定手机号",trigger:"blur"}],status:[{required:!0,message:"请选择账号状态",trigger:"change"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}]}}},methods:{handlePreview:function(a,e){this.baseData.contractAnnex=e},handleRemove:function(a,e){this.baseData.contractAnnex=e},annexSubmitUpload:function(){var a=this;this.loading=!0;var e=new FormData;this.baseData.contractAnnex.forEach(function(t){if(t.size>=1048576)throw a.$message.error("文件过大!"),a.loading=!1,new Error("文件过大!重新上传!");e.append("files",t.raw)}),this.baseData.annexId=[],uploadFiles(e).then(function(e){a.loading=!1,1==e.data.code?(e.data.body.forEach(function(e){a.baseData.annexId.push(e.id)}),a.$notify({title:"成功",message:e.data.msg,type:"success"})):a.$notify.error({title:"错误",message:e.data.msg})})},getQueryVariable:function(a){for(var e=window.location.hash.indexOf("?"),t=window.location.hash.substring(e+1,window.location.hash.length).split("&"),s=0;s<t.length;s++){var n=t[s].split("=");if(n[0]==a)return n[1]}return!1},handlclick:function(){"second"==this.activeName&&this.channelCard()},channelCard:function(){var a=this;Object(s.k)({chid:this.getQueryVariable("id"),cisVisible:0},!0).then(function(e){1==e.data.code&&(e.data.body.forEach(function(a){a.editMax=!1,a.editPrice=!1,a.edit=!1,a.supEdit=!1,a.originalPrice=a.channelPrices,a.originalMaxCardNum=a.maxCardNum,1==a.supStatus?a.supStatus=!1:a.supStatus=!0,a.originalSupStatus=a.supStatus}),a.couponTable=e.data.body)})},saveCouponRule:function(){var a=this,e={chName:this.baseData.channelName,chLevel:this.baseData.channelLevel,chAddress:this.baseData.address,chContacts:this.baseData.contacter,chPhone:this.baseData.phone,chEmail:this.baseData.email,inviteCode:this.baseData.inviteCode,chState:this.baseData.status,chIntroduce:this.baseData.introduce,chRemarks:this.baseData.note,operateUser:this.baseData.ownContact,chid:this.getQueryVariable("id"),uid:JSON.parse(window.sessionStorage.getItem("user")).uid,cardExamineRule:this.couponData.rule};Object(s.j)(e,!0).then(function(e){1==e.data.code?a.$notify({title:"成功",message:e.data.msg,type:"success"}):a.$notify.error({title:"错误",message:e.data.msg})})},saveChannel:function(){var a=this,e={chName:this.baseData.channelName,cardExamineRule:this.couponData.rule,chLevel:this.baseData.channelLevel,chAddress:this.baseData.address,chContacts:this.baseData.contacter,chPhone:this.baseData.phone,chEmail:this.baseData.email,inviteCode:this.baseData.inviteCode,chState:this.baseData.status,chIntroduce:this.baseData.introduce,chRemarks:this.baseData.note,operateUser:this.baseData.ownContact,chid:this.getQueryVariable("id"),contractStaTime:this.baseData.startTime,contractEndTime:this.baseData.endTime,contractAnnex:this.baseData.annexId.toString(),uid:JSON.parse(window.sessionStorage.getItem("user")).uid};this.$refs.baseData.$children.forEach(function(e,t){if(e.isRequired&&""==e.fieldValue)throw a.$message.error(e.label+"不能为空!"),finish=!0,new Error("表单验证错误")}),Object(s.j)(e,!0).then(function(e){1==e.data.code?a.$notify({title:"成功",message:e.data.msg,type:"success"}):a.$notify.error({title:"错误",message:e.data.msg})})},channel:function(){var a=this;Object(s.j)({chid:this.getQueryVariable("id")}).then(function(e){1==e.data.code&&(a.baseData.channelName=e.data.body.data[0].chName,a.baseData.channelLevel=e.data.body.data[0].chLevel,a.baseData.address=e.data.body.data[0].chAddress,a.baseData.contacter=e.data.body.data[0].chContacts,a.baseData.phone=e.data.body.data[0].chPhone,a.baseData.email=e.data.body.data[0].chEmail,a.baseData.inviteCode=e.data.body.data[0].inviteCode,a.baseData.status=e.data.body.data[0].chState,a.baseData.introduce=e.data.body.data[0].chIntroduce,a.baseData.note=e.data.body.data[0].chRemarks,a.baseData.startTime=e.data.body.data[0].contractStaTime,a.baseData.endTime=e.data.body.data[0].contractEndTime,a.baseData.annexId=e.data.body.data[0].contractAnnex.split(","),a.couponData.rule=e.data.body.data[0].cardExamineRule,a.channelRelation())})},editRow:function(a){a.edit=!0,a.editMax=!0,a.editPrice=!0,a.supEdit=!0},cancelEdit:function(a){a.channelPrices=a.originalPrice,a.maxCardNum=a.originalMaxCardNum,a.supStatus=a.originalSupStatus,a.edit=!1,a.editMax=!1,a.editPrice=!1,a.supEdit=!1,this.$message({message:"已取消操作!",type:"warning"})},confirmEdit:function(a){var e=this;if(/^((\d+)|([0].\d{0,2}|(\d+.\d{0,2})))$/.test(a.channelPrices)){a.supStatus?a.supStatus=0:a.supStatus=1;var t={channelCards:[{id:a.id,channelId:a.channelId,channelPrices:a.channelPrices,supStatus:a.supStatus,maxCardNum:a.maxCardNum}],uid:JSON.parse(window.sessionStorage.getItem("user")).uid};Object(s.k)(t).then(function(t){1==t.data.code&&(a.originalPrice=a.channelPrices,a.maxCoriginalMaxCardNumardNum=a.maxCardNum,1==a.supStatus?a.supStatus=!1:a.supStatus=!0,a.originalSupStatus=a.supStatus,a.edit=!1,a.editMax=!1,a.editPrice=!1,a.supEdit=!1,e.$message({message:t.data.msg,type:"success"}))})}else this.$message.error("价格只能为数字且保留两位小数")},channelRelation:function(){var a=this,e={chLevel:this.baseData.channelLevel,chid:this.getQueryVariable("id")};Object(s.l)(e).then(function(e){1==e.data.code&&e.data.body.forEach(function(e){var t={label:e.secChannelName,value:e.secChannelId};a.channelRelationList.push(t),1==e.supportState&&a.relation.push(e.secChannelId)})})},savleChannelRelation:function(){var a=this,e={chid:this.getQueryVariable("id"),chLevel:this.baseData.channelLevel,relationIds:this.relation.toString(),uid:JSON.parse(window.sessionStorage.getItem("user")).uid};Object(s.l)(e,!0).then(function(e){1==e.data.code?a.$notify({title:"成功",message:e.data.msg,type:"success"}):a.$notify.error({title:"错误",message:e.data.msg})})}},created:function(){},mounted:function(){this.channel()}},l={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"channelDetail"},[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":a.handlclick},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[t("div",{staticClass:"baseMsg"},[t("el-row",{attrs:{type:"flex"}},[t("el-col",{attrs:{span:12}},[t("el-form",{ref:"baseData",attrs:{rules:a.rules,model:a.baseData,"status-icon":"","label-width":"120px"}},[t("el-form-item",{attrs:{label:"渠道名称",prop:"channelName"}},[t("el-input",{attrs:{type:"text"},model:{value:a.baseData.channelName,callback:function(e){a.$set(a.baseData,"channelName",e)},expression:"baseData.channelName"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"渠道级别",prop:"channelLevel"}},[t("el-select",{attrs:{disabled:""},model:{value:a.baseData.channelLevel,callback:function(e){a.$set(a.baseData,"channelLevel",e)},expression:"baseData.channelLevel"}},a._l(a.baseData.channelLevels,function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value}})}),1)],1),a._v(" "),t("el-form-item",{attrs:{label:"渠道地址",prop:"address"}},[t("el-input",{attrs:{type:"text"},model:{value:a.baseData.address,callback:function(e){a.$set(a.baseData,"address",e)},expression:"baseData.address"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"联系人",prop:"contacter"}},[t("el-input",{attrs:{type:"text"},model:{value:a.baseData.contacter,callback:function(e){a.$set(a.baseData,"contacter",e)},expression:"baseData.contacter"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"绑定手机号",prop:"phone"}},[t("el-input",{attrs:{type:"text"},model:{value:a.baseData.phone,callback:function(e){a.$set(a.baseData,"phone",e)},expression:"baseData.phone"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"绑定邮箱",prop:"email"}},[t("el-input",{attrs:{type:"text"},model:{value:a.baseData.email,callback:function(e){a.$set(a.baseData,"email",e)},expression:"baseData.email"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"合同开始时间",prop:"startTime"}},[t("el-date-picker",{attrs:{clearable:"",type:"date","value-format":"yyyyMMddHHmmss",placeholder:"选择日期"},model:{value:a.baseData.startTime,callback:function(e){a.$set(a.baseData,"startTime",e)},expression:"baseData.startTime"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"合同结束时间",prop:"endTime"}},[t("el-date-picker",{attrs:{clearable:"",type:"date","value-format":"yyyyMMddHHmmss",placeholder:"选择日期"},model:{value:a.baseData.endTime,callback:function(e){a.$set(a.baseData,"endTime",e)},expression:"baseData.endTime"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"合同附件",prop:"contractAnnex"}},[t("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"#","on-change":a.handlePreview,"on-remove":a.handleRemove,"file-list":a.baseData.contractAnnex,"auto-upload":!1}},[t("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[a._v("选取文件")]),a._v(" "),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:a.annexSubmitUpload}},[a._v("上传到服务器")]),a._v(" "),t("a",{staticStyle:{"margin-left":"10px"},attrs:{href:"https://sapp.csgxcf.com:2843/seeObject?fi="+a.baseData.annexId,target:"_blank"}},[t("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[a._v("下载文件")])],1)],1)],1),a._v(" "),t("el-form-item",{attrs:{label:"帐号状态",prop:"status"}},[t("el-radio",{attrs:{label:"0"},model:{value:a.baseData.status,callback:function(e){a.$set(a.baseData,"status",e)},expression:"baseData.status"}},[a._v("启用")]),a._v(" "),t("el-radio",{attrs:{label:"1"},model:{value:a.baseData.status,callback:function(e){a.$set(a.baseData,"status",e)},expression:"baseData.status"}},[a._v("禁止")])],1)],1)],1),a._v(" "),t("el-col",{attrs:{span:12}},[t("el-form",{attrs:{"label-width":"120px"}},[t("el-form-item",{attrs:{label:"渠道介绍"}},[t("el-input",{attrs:{type:"textarea",rows:4},model:{value:a.baseData.introduce,callback:function(e){a.$set(a.baseData,"introduce",e)},expression:"baseData.introduce"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"我司联络人",prop:"ownContact"}},[t("el-input",{attrs:{type:"text"},model:{value:a.baseData.ownContact,callback:function(e){a.$set(a.baseData,"ownContact",e)},expression:"baseData.ownContact"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"渠道备注"}},[t("el-input",{attrs:{type:"textarea",rows:4},model:{value:a.baseData.note,callback:function(e){a.$set(a.baseData,"note",e)},expression:"baseData.note"}})],1)],1)],1)],1),a._v(" "),t("div",{staticClass:"btn"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:a.saveChannel}},[a._v("保存")]),a._v(" "),t("el-button",{attrs:{size:"small"},on:{click:function(e){return a.$router.push("/channelList")}}},[a._v("取消")])],1)],1)]),a._v(" "),t("el-tab-pane",{attrs:{label:"卡券设置",name:"second"}},[t("div",{staticClass:"couponMsg"},[t("el-table",{staticStyle:{width:"80%",margin:".1rem auto"},attrs:{data:a.couponTable,border:"","max-height":"5.6rem"}},[t("el-table-column",{attrs:{prop:"cardTypeName",align:"center",label:"卡劵类型"}}),a._v(" "),t("el-table-column",{attrs:{prop:"cardName",align:"center",label:"卡劵名称"}}),a._v(" "),t("el-table-column",{attrs:{align:"center",label:"渠道合作价格",prop:"channelPrices"},scopedSlots:a._u([{key:"default",fn:function(e){var s=e.row;return[s.editPrice?[t("el-input",{staticClass:"edit-input",attrs:{size:"small"},model:{value:s.channelPrices,callback:function(e){a.$set(s,"channelPrices",e)},expression:"row.channelPrices"}})]:t("span",[a._v(a._s(s.channelPrices))])]}}])}),a._v(" "),t("el-table-column",{attrs:{align:"center",label:"可派发卡券数量",prop:"maxCardNum"},scopedSlots:a._u([{key:"default",fn:function(e){var s=e.row;return[s.editMax?[t("el-input",{staticClass:"edit-input",attrs:{size:"small"},model:{value:s.maxCardNum,callback:function(e){a.$set(s,"maxCardNum",a._n(e))},expression:"row.maxCardNum"}})]:t("span",[a._v(a._s(s.maxCardNum))])]}}])}),a._v(" "),t("el-table-column",{attrs:{align:"center",label:"是否支持",prop:"maxCardNum"},scopedSlots:a._u([{key:"default",fn:function(e){var s=e.row;return[t("el-switch",{attrs:{disabled:!s.supEdit},model:{value:s.supStatus,callback:function(e){a.$set(s,"supStatus",e)},expression:"row.supStatus"}})]}}])}),a._v(" "),t("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:a._u([{key:"default",fn:function(e){var s=e.row;return[s.edit?t("div",[t("el-button",{attrs:{type:"success",size:"small"},on:{click:function(e){return a.confirmEdit(s)}}},[a._v("\n                      确定\n                    ")]),a._v(" "),t("el-button",{staticClass:"cancel-btn",attrs:{size:"small",type:"warning"},on:{click:function(e){return a.cancelEdit(s)}}},[a._v("\n                      取消\n                    ")])],1):t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return a.editRow(s)}}},[a._v("\n                    编辑\n                  ")])]}}])})],1)],1)]),a._v(" "),t("el-tab-pane",{attrs:{label:"卡券审核设置",name:"third"}},[t("div",{staticClass:"baseMsg"},[t("el-form",{attrs:{"label-width":"120px"}},[t("el-form-item",{attrs:{"v-model":a.couponData}},[t("el-form-item",{attrs:{label:"卡券审核规则"}},[t("el-input",{attrs:{type:"textarea",rows:5},model:{value:a.couponData.rule,callback:function(e){a.$set(a.couponData,"rule",e)},expression:"couponData.rule"}})],1)],1)],1),a._v(" "),t("div",{staticClass:"btn"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:a.saveCouponRule}},[a._v("保存")]),a._v(" "),t("el-button",{attrs:{size:"small"},on:{click:function(e){return a.$router.push("/channelList")}}},[a._v("取消")])],1)],1)]),a._v(" "),1==a.baseData.channelLevel?t("el-tab-pane",{attrs:{label:"关联下级渠道",name:"fourth"}},[t("div",{staticClass:"baseMsg"},[t("el-form",[t("el-form-item",{attrs:{"label-width":"120px",label:"关联下级渠道"}},[t("el-checkbox-group",{model:{value:a.relation,callback:function(e){a.relation=e},expression:"relation"}},a._l(a.channelRelationList,function(e){return t("el-checkbox",{key:e.value,attrs:{label:e.value}},[a._v(a._s(e.label))])}),1)],1)],1),a._v(" "),t("div",{staticClass:"btn"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:a.savleChannelRelation}},[a._v("保存")])],1)],1)]):a._e()],1)],1)},staticRenderFns:[]};var i=t("VU/8")(n,l,!1,function(a){t("vgaG")},"data-v-1a01d2b8",null);e.default=i.exports},vgaG:function(a,e){}});
//# sourceMappingURL=26.65de1953b03c6a0127bf.js.map