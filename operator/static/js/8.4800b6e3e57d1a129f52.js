webpackJsonp([8],{H0Ow:function(e,t){},Yenc:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("P9l9"),l=r("0w2Z"),o={name:"couponMsg",filters:{level:function(e){return 1==e?"一级":"二级"}},data:function(){return{filterMethod:function(e,t){return t.label.indexOf(e)>-1},activeName:"first",channelData:[],businessData:[],ruleForm:{channelCheckAll:!0,storeCheckAll:!0,couponName:"",couponType:"",couponTypes:[],effectTime:"",expirationTime:"",terminalPrice:"",evidence:"",couponNote:"",carOwnerNote:"",businessNote:"",storesOptions:[],channelsOptions:[],stores:[],channels:[]},channels:[],channelLabel:[],channelOption:[],channelIndeterminate:!1,stores:[],storeLabel:[],storeOption:[],storeIndeterminate:!1,rules:{couponType:[{required:!0,message:"请选择卡券类型",trigger:"change"}],couponName:[{max:10,message:"名称最多10个字符",trigger:"blur"},{required:!0,message:"请输入卡券名称",trigger:"blur"}],effectTime:[{required:!0,message:"请选择生效时间",trigger:"change"}],expirationTime:[{required:!0,message:"请选择过期时间",trigger:"change"}],channels:[{required:!0,type:"array",message:"请选择适用渠道",trigger:"change"}],stores:[{required:!0,type:"array",message:"请选择适用商户",trigger:"change"}],terminalPrice:[{validator:function(e,t,r){return console.log(e),t?/^((\d+)|([0].\d{0,2}|(\d+.\d{0,2})))$/.test(t)?void r():(r(new Error("价格只能为数字且保留两位小数")),!1):r(new Error("价格不能为空"))},required:!0,trigger:"blur"}],evidence:[{type:"number",message:"数量必须为数字值"},{required:!0,message:"请填写佐证数量",trigger:"blur"}]}}},methods:{getDicts:function(){var e=this;Object(a.q)({itemType:"cardType"}).then(function(t){for(var r in t.data.body){var a={label:t.data.body[r],value:r};e.ruleForm.couponTypes.push(a)}})},storeCheckAllChange:function(e){this.ruleForm.storesOptions=e?this.storeLabel:[],this.storeIndeterminate=!1},channelCheckAllChange:function(e){this.ruleForm.channelsOptions=e?this.channelLabel:[],this.channelIndeterminate=!1},storesOptionsChange:function(e){var t=e.length;this.ruleForm.storeCheckAll=t===this.storeOption.length,this.storeIndeterminate=t>0&&t<this.ruleForm.storesOptions.length},channelchannelsChange:function(e){var t=e.length;this.ruleForm.channelCheckAll=t===this.channelOption.length,this.channelIndeterminate=t>0&&t<this.ruleForm.channelsOptions.length},handlclick:function(){var e=this;"second"==this.activeName?Object(a.e)({id:Object(l.d)("id")}).then(function(t){1==t.data.code&&(e.channelData=t.data.body)}):"third"==this.activeName&&Object(a.i)({id:Object(l.d)("id")}).then(function(t){1==t.data.code&&(e.businessData=t.data.body)})},changTransfer:function(e){console.log(e),console.log(this.ruleForm.channels)},getCard:function(){var e=this;Object(a.f)({id:Object(l.d)("id")}).then(function(t){1==t.data.code&&(e.ruleForm.couponType=t.data.body.card.type,e.ruleForm.couponName=t.data.body.card.name,e.ruleForm.effectTime=t.data.body.card.staTime,e.ruleForm.expirationTime=t.data.body.card.expTime,e.ruleForm.terminalPrice=t.data.body.card.price,e.ruleForm.evidence=t.data.body.card.needProveNum,e.ruleForm.couponNote=t.data.body.card.cardExplain,e.ruleForm.carOwnerNote=t.data.body.card.userExplain,e.ruleForm.businessNote=t.data.body.card.merchantExplain,e.storeOption=t.data.body.store,e.storeOption.forEach(function(t){t.label=t.storeName,t.key=t.storeId,0==t.sisVisible?(e.ruleForm.storesOptions.push(t.storeName),e.ruleForm.stores.push(t.storeId)):e.ruleForm.storeCheckAll=!1,e.storeLabel.push(t)}),e.channelOption=t.data.body.channel,e.channelOption.forEach(function(t){t.label=t.channelName,t.key=t.channelId,0==t.cisVisible?(e.ruleForm.channelsOptions.push(t.channelName),e.ruleForm.channels.push(t.channelId)):e.ruleForm.channelCheckAll=!1,e.channelLabel.push(t)}))})},cardClass:function(){var e=this,t=!1;if(this.$refs.leftForm.$children.forEach(function(r,a){if(r.isRequired&&""==r.fieldValue)throw e.$message.error(r.label+"不能为空!"),t=!0,new Error("表单验证错误")}),!t&&(this.$refs.rightForm.$children.forEach(function(r,a){if(r.isRequired&&""==r.fieldValue)throw e.$message.error(r.label+"不能为空!"),t=!0,new Error("表单验证错误")}),!t)){var r={name:this.ruleForm.couponName,id:Object(l.d)("id"),staTime:this.ruleForm.effectTime,expTime:this.ruleForm.expirationTime,type:this.ruleForm.couponType,price:this.ruleForm.terminalPrice,needProveNum:this.ruleForm.evidence,cardExplain:this.ruleForm.couponNote,userExplain:this.ruleForm.carOwnerNote,merchantExplain:this.ruleForm.businessNote,applyChannel:this.ruleForm.channels.toString(),applyStore:this.ruleForm.stores.toString(),uid:JSON.parse(window.sessionStorage.getItem("user")).uid};Object(a.f)(r,"edit").then(function(t){1==t.data.code?(e.$notify({title:"成功",message:t.data.msg,type:"success"}),e.$router.push("/couponList")):e.$notify.error({title:"错误",message:t.data.msg})})}}},created:function(){this.getDicts()},mounted:function(){this.getCard()}},n={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"couponMsg"},[r("el-tabs",{staticClass:"tabs",attrs:{type:"card"},on:{"tab-click":e.handlclick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[r("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[r("div",{staticClass:"baseMsg"},[r("el-row",{attrs:{type:"flex"}},[r("el-col",{attrs:{span:11}},[r("el-form",{ref:"leftForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"卡券类型:",prop:"couponType"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.ruleForm.couponType,callback:function(t){e.$set(e.ruleForm,"couponType",t)},expression:"ruleForm.couponType"}},e._l(e.ruleForm.couponTypes,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"卡券名称",prop:"couponName"}},[r("el-input",{attrs:{clearable:""},model:{value:e.ruleForm.couponName,callback:function(t){e.$set(e.ruleForm,"couponName",t)},expression:"ruleForm.couponName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"生效时间",prop:"effectTime"}},[r("el-date-picker",{attrs:{"value-format":"yyyyMMddHHmmss","default-time":"00:00:00",type:"datetime",placeholder:"选择生效时间"},model:{value:e.ruleForm.effectTime,callback:function(t){e.$set(e.ruleForm,"effectTime",t)},expression:"ruleForm.effectTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"过期时间",prop:"expirationTime"}},[r("el-date-picker",{attrs:{"value-format":"yyyyMMddHHmmss","default-time":"23:59:59",type:"datetime",placeholder:"选择过期时间"},model:{value:e.ruleForm.expirationTime,callback:function(t){e.$set(e.ruleForm,"expirationTime",t)},expression:"ruleForm.expirationTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"终端价格",prop:"terminalPrice"}},[r("el-input",{attrs:{clearable:""},model:{value:e.ruleForm.terminalPrice,callback:function(t){e.$set(e.ruleForm,"terminalPrice",t)},expression:"ruleForm.terminalPrice"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"需要佐证数量",prop:"evidence"}},[r("el-input",{attrs:{clearable:""},model:{value:e.ruleForm.evidence,callback:function(t){e.$set(e.ruleForm,"evidence",e._n(t))},expression:"ruleForm.evidence"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"卡券说明",prop:"couponNote"}},[r("el-input",{attrs:{clearable:"",type:"textarea",maxlength:"100",rows:4,"show-word-limit":""},model:{value:e.ruleForm.couponNote,callback:function(t){e.$set(e.ruleForm,"couponNote",t)},expression:"ruleForm.couponNote"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"车主说明",prop:"carOwnerNote"}},[r("el-input",{attrs:{clearable:"",type:"textarea",maxlength:"100",rows:4,"show-word-limit":""},model:{value:e.ruleForm.carOwnerNote,callback:function(t){e.$set(e.ruleForm,"carOwnerNote",t)},expression:"ruleForm.carOwnerNote"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"商户说明",prop:"businessNote"}},[r("el-input",{attrs:{clearable:"",type:"textarea",maxlength:"100",rows:4,"show-word-limit":""},model:{value:e.ruleForm.businessNote,callback:function(t){e.$set(e.ruleForm,"businessNote",t)},expression:"ruleForm.businessNote"}})],1)],1)],1),e._v(" "),r("el-col",{attrs:{span:13}},[r("el-form",{ref:"rightForm",attrs:{"status-icon":"",model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"适用渠道",prop:"channels"}},[r("el-transfer",{attrs:{filterable:"","filter-method":e.filterMethod,"button-texts":["不适用","适用"],"filter-placeholder":"请输入渠道名称",titles:["全部渠道","适用渠道"],data:e.channelLabel},on:{change:e.changTransfer},model:{value:e.ruleForm.channels,callback:function(t){e.$set(e.ruleForm,"channels",t)},expression:"ruleForm.channels"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"适用商户",prop:"stores"}},[r("el-transfer",{attrs:{filterable:"","filter-method":e.filterMethod,"button-texts":["不适用","适用"],"filter-placeholder":"请输入商户名称",titles:["全部商户","适用商户"],data:e.storeLabel},on:{change:e.changTransfer},model:{value:e.ruleForm.stores,callback:function(t){e.$set(e.ruleForm,"stores",t)},expression:"ruleForm.stores"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"卡券背景类型",prop:"typeBg"}},[r("el-select",{model:{value:e.ruleForm.typeBg,callback:function(t){e.$set(e.ruleForm,"typeBg",t)},expression:"ruleForm.typeBg"}},e._l(e.ruleForm.typeBgs,function(e,t){return r("el-option",{key:t,attrs:{value:e.value,label:e.label}})}),1)],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"btn"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.cardClass}},[e._v("保存")]),e._v(" "),r("el-button",{attrs:{size:"small"},on:{click:function(t){return e.$router.push("/couponList")}}},[e._v("取消")])],1)],1)]),e._v(" "),r("el-tab-pane",{attrs:{label:"渠道合作价格",name:"second"}},[r("div",{staticClass:"channelPrice"},[r("el-table",{staticStyle:{width:"30%"},attrs:{data:e.channelData,border:""}},[r("el-table-column",{attrs:{prop:"channelLevel",label:"渠道级别",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("p",[e._v(e._s(e._f("level")(t.row.channelLevel)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"channelName",label:"合作渠道",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"channelPrices",label:"合作价格",align:"center"}})],1)],1)]),e._v(" "),r("el-tab-pane",{attrs:{label:"商户合作价格",name:"third"}},[r("div",{staticClass:"businessPrice"},[r("el-table",{staticStyle:{width:"30%"},attrs:{data:e.businessData,border:""}},[r("el-table-column",{attrs:{prop:"storeName",label:"合作商户",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"storePrices",label:"合作价格",align:"center"}})],1)],1)])],1)],1)},staticRenderFns:[]};var s=r("VU/8")(o,n,!1,function(e){r("H0Ow")},"data-v-9b56e62c",null);t.default=s.exports}});
//# sourceMappingURL=8.4800b6e3e57d1a129f52.js.map